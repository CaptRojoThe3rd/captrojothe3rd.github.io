<!DOCTYPE html>
<head>
	<link rel="stylesheet" href="styles.css">
</head>
<body>
	<div class="top-area" style="height: 150px;">
		<div class="title">
			<p>
				captrojothe3rd.github.io
			</p>
		</div>
		<div id="chrome-height-adjust" style="height: 0px;"></div>
		<div class="subtitle-adjust">
			<div class="normal-centered-text">
				<p>
					eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
				</p>
			</div>
			<div style="width: 50%; margin: auto; margin-top: -20px;">
				<center>
					<button class="top-area-button" onclick="window.location.href='https://captrojothe3rd.github.io'">Home</button>
					<button class="top-area-button" onclick="window.location.href='https://captrojothe3rd.github.io/calculators'">Calculators</button>
					<button class="top-area-button" onclick="window.location.href='https://captrojothe3rd.github.io/nesguide'">NES Programming</button>
				</center>
			</div>
		</div>
	</div>

	<div class="side-area">
		<br>
		<!-- Title -->
		<p style="line-height: 10px; margin-top: 10px; font-size: 20px; margin-left: 10px;">NES Programming Guide</p>
			<!--1 - Software-->
			<a href="/nesguide/software" style="font-size: 16px; margin-left: 30px;">1 - Software</a>
			<br>
				<!--1.1 - CA65-->
				<a href="/nesguide/software/ca65" style="font-size: 16px; margin-left: 50px;">1.1 - CA65</a>
				<br>
				<!--1.2 - VSCode-->
				<a href="/nesguide/software/vscode" style="font-size: 16px; margin-left: 50px;">1.2 - VSCode</a>
				<br>
				<!--1.3 - YYCHR-->
				<a href="/nesguide/software/yychr" style="font-size: 16px; margin-left: 50px;">1.3 - YYCHR</a>
				<br>
				<!--1.4 - NES Emulator-->
				<a href="/nesguide/software/emulator" style="font-size: 16px; margin-left: 50px;">1.4 - NES Emulator</a>
				<br>
				<!--1.5 - Hex Editor-->
				<a href="/nesguide/software/hex" style="font-size: 16px; margin-left: 50px;">1.5 - Hex Editor</a>
				<br>
				<!--1.6 - Python-->
				<a href="/nesguide/software/python" style="font-size: 16px; margin-left: 50px;">1.6 - Python</a>
				<br>
			<!--2 - Setup-->
			<a href="/nesguide/setup" style="font-size: 16px; margin-left: 30px;">2 - Setup</a>
			<br>
				<!--2.1 - Required Code-->
				<a href="/nesguide/setup/requiredcode" style="font-size: 16px; margin-left: 50px;">2.1 - Required Code</a>
				<br>
				<!--2.2 - Adding CHR-ROM Data-->
				<a href="/nesguide/setup/chrrom" style="font-size: 16px; margin-left: 50px;">2.2 - Adding CHR-ROM Data</a>
				<br>
				<!--2.3 - Build Task-->
				<a href="/nesguide/setup/buildtask" style="font-size: 16px; margin-left: 50px;">2.3 - Build Task</a>
				<br>
			<!--3 - 6502 Assembly-->
			<a href="/nesguide/6502assembly" style="font-size: 16px; margin-left: 30px;">3 - 6502 Assembly</a>
			<br>
				<!--3.1 - CA65 Features-->
				<a href="/nesguide/6502assembly/ca65features" style="font-size: 16px; margin-left: 50px;">3.1 - CA65 Features</a>
				<br>
				<!--3.2 - Load/Store Instructions-->
				<a href="/nesguide/6502assembly/loadstore" style="font-size: 16px; margin-left: 50px;">3.2 - Load/Store Instructions</a>
				<br>
				<!--3.3 - Arithmetic Instructions-->
				<a href="/nesguide/6502assembly/arithmetic" style="font-size: 16px; margin-left: 50px;">3.3 - Arithmetic Instructions</a>
				<br>
				<!--3.4 - Comparison Instructions-->
				<a href="/nesguide/6502assembly/comparison" style="font-size: 16px; margin-left: 50px;">3.4 - Comparison Instructions</a>
				<br>
				<!--3.5 - Jump/Branching Instructions-->
				<a href="/nesguide/6502assembly/jumpbranching" style="font-size: 16px; margin-left: 50px;">3.5 - Jump/Branching Instructions</a>
				<br>
				<!--3.6 - Register/Flag Instructions-->
				<a href="/nesguide/6502assembly/registerflag" style="font-size: 16px; margin-left: 50px;">3.6 - Register/Flag Instructions</a>
				<br>
				<!--3.7 - Stack Instructions-->
				<a href="/nesguide/6502assembly/stack" style="font-size: 16px; margin-left: 50px;">3.7 - Stack Instructions</a>
				<br>
				<!--3.8 - Illegal Instructions-->
				<a href="/nesguide/6502assembly/illegal" style="font-size: 16px; margin-left: 50px;">3.8 - Illegal Instructions</a>
				<br>
			<!--4 - NES Hardware-->
			<a href="/nesguide/hardware" style="font-size: 16px; margin-left: 30px;">4 - NES Hardware</a>
			<br>
				<!--4.1 - Memory Layout-->
				<a href="/nesguide/hardware/memorylayout" style="font-size: 16px; margin-left: 50px;">4.1 - Memory Layout</a>
				<br>
				<!--4.2 - CPU Registers-->
				<a href="/nesguide/hardware/cpuregisters" style="font-size: 16px; margin-left: 50px;">4.2 - CPU Registers</a>
				<br>
				<!--4.3 - PPU Registers-->
				<a href="/nesguide/hardware/ppuregisters" style="font-size: 16px; margin-left: 50px;">4.3 - PPU Registers</a>
				<br>
			<!--5 - Graphics-->
			<a href="/nesguide/graphics" style="font-size: 16px; margin-left: 30px;">5 - Graphics</a>
			<br>
				<!--5.1 - Editing CHR-ROM-->
				<a href="/nesguide/graphics/editingchrrom" style="font-size: 16ppx; margin-left: 50px;">5.1 - Editing CHR-ROM</a>
				<br>
				<!--5.2 - Palettes-->
				<a href="/nesguide/graphics/palettes" style="font-size: 16px; margin-left: 50px;">5.2 - Palettes</a>
				<br>
				<!--5.3 - Background Tiles-->
				<a href="/nesguide/graphics/bgtiles" style="font-size: 16px; margin-left: 50px;">5.3 - Background Tiles</a>
				<br>
				<!--5.4 - Sprites-->
				<a href="/nesguide/graphics/sprites" style="font-size: 16px; margin-left: 50px;">5.4 - Sprites</a>
				<br>
				<!--5.5 - OAM DMA-->
				<a href="/nesguide/graphics/oamdma" style="font-size: 16px; margin-left: 50px;">5.5 - OAM DMA</a>
				<br>
				<!--5.6 - Scrolling-->
				<a href="/nesguide/graphics/scrolling" style="font-size: 16px; margin-left: 50px;">5.6 - Scrolling</a>
				<br>
				<!--5.7 - Sprite 0-->
				<a href="/nesguide/graphics/spritezero" style="font-size: 16px; margin-left: 50px;">5.7 - Sprite 0</a>
				<br>
			<!--6 - Audio-->
			<a href="/nesguide/audio" style="font-size: 16px; margin-left: 30px;">6 - Audio</a>
			<br>
				<!--6.1 - Square Channels-->
				<a href="/nesguide/audio/square" style="font-size: 16px; margin-left: 50px;">6.1 - Square Channels</a>
				<br>
				<!--6.2 - Triangle Channel-->
				<a href="/nesguide/audio/triangle" style="font-size: 16px; margin-left: 50px;">6.2 - Triangle Channel</a>
				<br>
				<!--6.3 - Noise Channel-->
				<a href="/nesguide/audio/noise" style="font-size: 16px; margin-left: 50px;">6.3 - Noise Channel</a>
				<br>
				<!--6.4 - DPCM-->
				<a href="/nesguide/audio/dpcm" style="font-size: 16px; margin-left: 50px;">6.4 - DPCM</a>
				<br>
			<!--7 - Input-->
			<a href="/nesguide/input" style="font-size: 16px; margin-left: 30px;">7 - Input</a>
			<br>
				<!--7.1 - 1/2 Controllers-->
				<a href="/nesguide/input/singlecontroller" style="font-size: 16px; margin-left: 50px;">7.1 - 1/2 Controllers</a>
				<br>
				<!--7.2 - 3/4 Controllers Using Four Score-->
				<a href="/nesguide/input/fourscore" style="font-size: 16px; margin-left: 50px;">7.2 - 3/4 Controllers Using Four Score</a>
				<br>
				<!--7.3 - Zapper Gun-->
				<a href="/nesguide/input/zappergun" style="font-size: 16px; margin-left: 50px;">7.3 - Zapper Gun</a>
				<br>
				<!--7.4 - Family Basic Keyboard-->
				<a href="/nesguide/input/familybasickeyboard" style="font-size: 16px; margin-left: 50px;">7.4 - Family Basic Keyboard</a>
				<br>
				<!--7.5 - Power Pad-->
				<a href="/nesguide/input/powerpad" style="font-size: 16px; margin-left: 50px;">7.5 - Power Pad</a>
				<br>
			<!--8 - Mappers-->
			<a href="/nesguide/mappers" style="font-size: 16px; margin-left: 30px;">8 - Mappers</a>
			<br>
				<!--8.1 - MMC1-->
				<a href="/nesguide/mappers/mmc1" style="font-size: 16px; margin-left: 50px;">8.1 - MMC1</a>
				<br>
				<!--8.2 - MMC3-->
				<a href="/nesguide/mappers/mmc3" style="font-size: 16px; margin-left: 50px;">8.2 - MMC3</a>
				<br>
				<!--8.3 - MMC5-->
				<a href="/nesguide/mappers/mmc5" style="font-size: 16px; margin-left: 50px;">8.3 - MMC5</a>
				<br>
	</div>

	<div class="main-area">
		<p>
			Now, with only background tiles, moving something across the screen isn't that easy. You could only move 8 pixels at a time, and attributes would be an issue.
			With sprites, this becomes much easier.
			<br>
			The NES has OAM RAM for 64 sprites. OAM means Object Attribute Memory, and sprites are technically referred to as objects. This guide will refer to them as sprites,
			though. 
		</p>
		<img src="smb3-only-sprites.png" alt="Super Mario Bros. 3 with only sprites displayed" style="width: 583px; height: 478px;">
		<br>
		<br>
		<p>
			Despite the capacity for 64 sprites, the NES can only display 8 sprites per scanline. If there are more sprites, the extra sprites won't render. Sprites earlier in
			OAM RAM have priority over sprites later in OAM RAM, and this affects both sprites on top of each other as well as more than 8 sprites per scanline. 
		</p>
		<img src="smb3gif.gif" alt="GIF showing sprite overflow" style="width: 640px; height: 360px;">
		<br>
		<br>
		<p>
			If you keep running into the issue of sprite overflow, you can use a flickering effect, such as the one in the image above.
		</p>
		<br>
		<p>
			Unlike background tiles, sprites can be either 8x8 or 8x16 pixels in size, toggled by a bit in PPU Control ($2000). When in 8x8 mode, indexing works the same as 
			background tiles. In 8x16 mode, sprites can access both CHR-ROM tables ($0000 and $1000) based on whether the tile index is even or odd.
			<br>
			These are the tiles each sprite index would access:
		</p>
		<img src="8x16sprtable0.png" alt="Table 0" style="width: 385px; height: 384px;">
		<img src="8x16sprtable1.png" alt="Table 1" style="width: 384px; height: 385px;">
		<br>
		<br>
		<p>
			And here is one of Super Mario Bros. 3's CHR-ROM tables, not arranged and arranged for 8x16 tiles:
		</p>
		<img src="smb3tiles.png" alt="Some of Super Mario Bros. 3's tiles" style="width: 385px; height: 385px;">
		<img src="smb3tilesarranged.png" alt="SMB3's tiles arranged for 8x16 sprites" style="width: 385px; height: 385px;">
		<br>
		<br>
		<p>
			The sprite mode is determined by bit 5 (bit "H" below) in PPU Control ($2000).
		</p>
		<br>
		<p class="code">
			$2000: PPU Control
		</p>
		<p class="code" style="margin-left: 86px; margin-right: 0">
			VPHB SINN
			<br>
			|||| ||++-- Base nametable address (0 = $2000; 1 = $2400; 2 = $2800; 3 = $2c00)
			<br>
			|||| |+---- VRAM address increment per CPU read/write of PPU Data (0: add 1, going across; 1: add 32, going down)
			<br>
			|||| +----- Sprite pattern table address for 8x8 sprites (0: $0000; 1: $1000)
			<br>
			|||+------- Background pattern table address (0: $1000; 1: $1000)
			<br>
			||+-------- <strong style="font-size: 13px;">Sprite size (0: 8x8; 1: 8x16)</strong>
			<br>
			|+--------- PPU master/slave select (0: read backdrop from EXT pins; 1: output color on EXT pins)
			<br>
			+---------- Generate an NMI at the start of the vertical blanking interval (0: off; 1: on)
		</p>
		<br>
		<br>
		<p>
			While a background tile uses 1 byte, a sprite uses 4 bytes.
			<br>
			Byte 1: Y Position
			<br>
			Byte 2: Tile Index
			<br>
			Byte 3: Attributes
			<br>
			Byte 4: X Position
			<br>
			<br>
			The Y Position, Tile Index, and X Position bytes are self-explanatory. The attribute byte contains more than just the palette, and below is a description of it.
		</p>
		<br>
		<p class="code">
			Sprite Attribute Byte
		</p>
		<p class="code" style="margin-left: 86px;">
			VHB---PP
			<br>
			|||&nbsp;&nbsp;&nbsp;++-- Palette index
			<br>
			||+------- Background Priorty (0: render on top of background, 1: render behind background)
			<br>
			|+-------- Horizontal Flip
			<br>
			+--------- Vertical Flip
		</p>
		<br>
		<br>
		<p>
			To add a sprite to OAM RAM, you can use the OAM Address ($2003) and OAM Data ($2004) registers. This bit of code writes a single sprite to the screen near the top
			left corner, below the "Hello, World!" written with background tiles. WARNING: Sprite code needs to be written during vBlank / NMI, since OAM RAM can decay after
			a vBlank without writes.
		</p>
		<br>
		<p class="code">
			lda #0
			<br>
			sta OamAddr_2003
			<br>
			<br>
			lda #24
			<br>
			sta OamData_2004
			<br>
			lda #0
			<br>
			sta OamData_2004
			<br>
			sta OamData_2004
			<br>
			lda #8
			<br>
			sta OamData_2004
			<br>
		</p>
		<br>
		<img src="spritebelowhelloworld.png" alt="Sprite below 'Hello, World!' text" style="width: 587px; height: 508px;">
		<br>
		<br>
		<p>
			To disable/hide a sprite, you can simply set the Y position to be greater than 240. Since this is in vBlank, they won't render.
		</p>
		<br>
		<p>
			You may have noticed that in the first image, there are solid rectangle sprites below the Piranha Plant. You might have wondered what this was for.
			<br>
			Here's the explanation: To hide the Piranha Plant behind the pipe when it is moving up or down, it is covered by a higher-priorty sprite (earlier in
			OAM RAM) that has the Background Priorty bit set, so that it renders behind the pipe. Since the Background Priorty sprite has priority, it covers the
			Piranha Plant's sprites as they go inside the pipe.
			<br>
			Mario has a similar system to hide him when going in pipes, and it can be seen when performing the pipe glitch:
		</p>
		<br>
		<img src="pipe-glitch.gif" alt="GIF of SMB3 pipe glitch">
	</div>
</body>
