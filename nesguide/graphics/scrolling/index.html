<!DOCTYPE html>
<head>
	<link rel="stylesheet" href="styles.css">
</head>
<body>
	<div class="top-area" style="height: 150px;">
		<div class="title">
			<p>
				captrojothe3rd.github.io
			</p>
		</div>
		<div id="chrome-height-adjust" style="height: 0px;"></div>
		<div class="subtitle-adjust">
			<div class="normal-centered-text">
				<p>
					eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
				</p>
			</div>
			<div style="width: 50%; margin: auto; margin-top: -20px;">
				<center>
					<button class="top-area-button" onclick="window.location.href='https://captrojothe3rd.github.io'">Home</button>
					<button class="top-area-button" onclick="window.location.href='https://captrojothe3rd.github.io/calculators'">Calculators</button>
					<button class="top-area-button" onclick="window.location.href='https://captrojothe3rd.github.io/nesguide'">NES Programming</button>
				</center>
			</div>
		</div>
	</div>

	<div class="side-area">
		<br>
		<!-- Title -->
		<p style="line-height: 10px; margin-top: 10px; font-size: 20px; margin-left: 10px;">NES Programming Guide</p>
			<!--1 - Software-->
			<a href="/nesguide/software" style="font-size: 16px; margin-left: 30px;">1 - Software</a>
			<br>
				<!--1.1 - CA65-->
				<a href="/nesguide/software/ca65" style="font-size: 16px; margin-left: 50px;">1.1 - CA65</a>
				<br>
				<!--1.2 - VSCode-->
				<a href="/nesguide/software/vscode" style="font-size: 16px; margin-left: 50px;">1.2 - VSCode</a>
				<br>
				<!--1.3 - YYCHR-->
				<a href="/nesguide/software/yychr" style="font-size: 16px; margin-left: 50px;">1.3 - YYCHR</a>
				<br>
				<!--1.4 - NES Emulator-->
				<a href="/nesguide/software/emulator" style="font-size: 16px; margin-left: 50px;">1.4 - NES Emulator</a>
				<br>
				<!--1.5 - Hex Editor-->
				<a href="/nesguide/software/hex" style="font-size: 16px; margin-left: 50px;">1.5 - Hex Editor</a>
				<br>
				<!--1.6 - Python-->
				<a href="/nesguide/software/python" style="font-size: 16px; margin-left: 50px;">1.6 - Python</a>
				<br>
			<!--2 - Setup-->
			<a href="/nesguide/setup" style="font-size: 16px; margin-left: 30px;">2 - Setup</a>
			<br>
				<!--2.1 - Required Code-->
				<a href="/nesguide/setup/requiredcode" style="font-size: 16px; margin-left: 50px;">2.1 - Required Code</a>
				<br>
				<!--2.2 - Adding CHR-ROM Data-->
				<a href="/nesguide/setup/chrrom" style="font-size: 16px; margin-left: 50px;">2.2 - Adding CHR-ROM Data</a>
				<br>
				<!--2.3 - Build Task-->
				<a href="/nesguide/setup/buildtask" style="font-size: 16px; margin-left: 50px;">2.3 - Build Task</a>
				<br>
			<!--3 - 6502 Assembly-->
			<a href="/nesguide/6502assembly" style="font-size: 16px; margin-left: 30px;">3 - 6502 Assembly</a>
			<br>
				<!--3.1 - CA65 Features-->
				<a href="/nesguide/6502assembly/ca65features" style="font-size: 16px; margin-left: 50px;">3.1 - CA65 Features</a>
				<br>
				<!--3.2 - Load/Store Instructions-->
				<a href="/nesguide/6502assembly/loadstore" style="font-size: 16px; margin-left: 50px;">3.2 - Load/Store Instructions</a>
				<br>
				<!--3.3 - Arithmetic Instructions-->
				<a href="/nesguide/6502assembly/arithmetic" style="font-size: 16px; margin-left: 50px;">3.3 - Arithmetic Instructions</a>
				<br>
				<!--3.4 - Comparison Instructions-->
				<a href="/nesguide/6502assembly/comparison" style="font-size: 16px; margin-left: 50px;">3.4 - Comparison Instructions</a>
				<br>
				<!--3.5 - Jump/Branching Instructions-->
				<a href="/nesguide/6502assembly/jumpbranching" style="font-size: 16px; margin-left: 50px;">3.5 - Jump/Branching Instructions</a>
				<br>
				<!--3.6 - Register/Flag Instructions-->
				<a href="/nesguide/6502assembly/registerflag" style="font-size: 16px; margin-left: 50px;">3.6 - Register/Flag Instructions</a>
				<br>
				<!--3.7 - Stack Instructions-->
				<a href="/nesguide/6502assembly/stack" style="font-size: 16px; margin-left: 50px;">3.7 - Stack Instructions</a>
				<br>
				<!--3.8 - Illegal Instructions-->
				<a href="/nesguide/6502assembly/illegal" style="font-size: 16px; margin-left: 50px;">3.8 - Illegal Instructions</a>
				<br>
			<!--4 - NES Hardware-->
			<a href="/nesguide/hardware" style="font-size: 16px; margin-left: 30px;">4 - NES Hardware</a>
			<br>
				<!--4.1 - Memory Layout-->
				<a href="/nesguide/hardware/memorylayout" style="font-size: 16px; margin-left: 50px;">4.1 - Memory Layout</a>
				<br>
				<!--4.2 - CPU Registers-->
				<a href="/nesguide/hardware/cpuregisters" style="font-size: 16px; margin-left: 50px;">4.2 - CPU Registers</a>
				<br>
				<!--4.3 - PPU Registers-->
				<a href="/nesguide/hardware/ppuregisters" style="font-size: 16px; margin-left: 50px;">4.3 - PPU Registers</a>
				<br>
			<!--5 - Graphics-->
			<a href="/nesguide/graphics" style="font-size: 16px; margin-left: 30px;">5 - Graphics</a>
			<br>
				<!--5.1 - Editing CHR-ROM-->
				<a href="/nesguide/graphics/editingchrrom" style="font-size: 16ppx; margin-left: 50px;">5.1 - Editing CHR-ROM</a>
				<br>
				<!--5.2 - Palettes-->
				<a href="/nesguide/graphics/palettes" style="font-size: 16px; margin-left: 50px;">5.2 - Palettes</a>
				<br>
				<!--5.3 - Background Tiles-->
				<a href="/nesguide/graphics/bgtiles" style="font-size: 16px; margin-left: 50px;">5.3 - Background Tiles</a>
				<br>
				<!--5.4 - Sprites-->
				<a href="/nesguide/graphics/sprites" style="font-size: 16px; margin-left: 50px;">5.4 - Sprites</a>
				<br>
				<!--5.5 - OAM DMA-->
				<a href="/nesguide/graphics/oamdma" style="font-size: 16px; margin-left: 50px;">5.5 - OAM DMA</a>
				<br>
				<!--5.6 - Scrolling-->
				<a href="/nesguide/graphics/scrolling" style="font-size: 16px; margin-left: 50px;">5.6 - Scrolling</a>
				<br>
				<!--5.7 - Sprite 0-->
				<a href="/nesguide/graphics/spritezero" style="font-size: 16px; margin-left: 50px;">5.7 - Sprite 0</a>
				<br>
			<!--6 - Audio-->
			<a href="/nesguide/audio" style="font-size: 16px; margin-left: 30px;">6 - Audio</a>
			<br>
				<!--6.1 - Square Channels-->
				<a href="/nesguide/audio/square" style="font-size: 16px; margin-left: 50px;">6.1 - Square Channels</a>
				<br>
				<!--6.2 - Triangle Channel-->
				<a href="/nesguide/audio/triangle" style="font-size: 16px; margin-left: 50px;">6.2 - Triangle Channel</a>
				<br>
				<!--6.3 - Noise Channel-->
				<a href="/nesguide/audio/noise" style="font-size: 16px; margin-left: 50px;">6.3 - Noise Channel</a>
				<br>
				<!--6.4 - DPCM-->
				<a href="/nesguide/audio/dpcm" style="font-size: 16px; margin-left: 50px;">6.4 - DPCM</a>
				<br>
			<!--7 - Input-->
			<a href="/nesguide/input" style="font-size: 16px; margin-left: 30px;">7 - Input</a>
			<br>
				<!--7.1 - 1/2 Controllers-->
				<a href="/nesguide/input/singlecontroller" style="font-size: 16px; margin-left: 50px;">7.1 - 1/2 Controllers</a>
				<br>
				<!--7.2 - 3/4 Controllers Using Four Score-->
				<a href="/nesguide/input/fourscore" style="font-size: 16px; margin-left: 50px;">7.2 - 3/4 Controllers Using Four Score</a>
				<br>
				<!--7.3 - Zapper Gun-->
				<a href="/nesguide/input/zappergun" style="font-size: 16px; margin-left: 50px;">7.3 - Zapper Gun</a>
				<br>
				<!--7.4 - Family Basic Keyboard-->
				<a href="/nesguide/input/familybasickeyboard" style="font-size: 16px; margin-left: 50px;">7.4 - Family Basic Keyboard</a>
				<br>
				<!--7.5 - Power Pad-->
				<a href="/nesguide/input/powerpad" style="font-size: 16px; margin-left: 50px;">7.5 - Power Pad</a>
				<br>
			<!--8 - Mappers-->
			<a href="/nesguide/mappers" style="font-size: 16px; margin-left: 30px;">8 - Mappers</a>
			<br>
				<!--8.1 - MMC1-->
				<a href="/nesguide/mappers/mmc1" style="font-size: 16px; margin-left: 50px;">8.1 - MMC1</a>
				<br>
				<!--8.2 - MMC3-->
				<a href="/nesguide/mappers/mmc3" style="font-size: 16px; margin-left: 50px;">8.2 - MMC3</a>
				<br>
				<!--8.3 - MMC5-->
				<a href="/nesguide/mappers/mmc5" style="font-size: 16px; margin-left: 50px;">8.3 - MMC5</a>
				<br>
	</div>

	<div class="main-area">
		<p>
			Now, while a game that doesn't scroll or move from a single screen is perfectly acceptable, certain kinds of games need scrolling. 
			<br>
			<br>
			Well, you can't just rewrite an entire nametable in one frame. Since it needs to be in vBlank to prevent graphical glitches, there simply isn't enough time
			in a frame, let alone a single vBlank interval.
			<br>
			<br>
			So what's the solution? Well, the PPU has a scrolling feature. The PPU Scroll Register, at $2005 (Mesen label: PpuScroll_2005), can scroll the screen without
			needing any writes to VRAM.
			<br>
			The PPU Scroll ($2005) register needs to be written to twice: The first write is the X Scroll value, and the second write is the Y Scroll value.
		</p>
		<br>
		<p class="code">
			lda XScroll
			<br>
			sta PpuScroll_2005
			<br>
			lda YScroll
			<br>
			sta PpuScroll_2005
		</p>
		<br>
		<br>
		<p>
			By incrementing X and Y scroll once per frame, we get this result:
		</p>
		<img src="scroll1.gif" alt="Scrolling with just $2005">
		<br>
		<br>
		<p>
			However, with just the PPU Scroll ($2005) register, there is a problem: when reaching the edge of the screen, the scroll value rolls back to 0 and the screen snaps
			back to the first nametable.
			<br>
			<br>
			However, there is a solution. In the PPU Control ($2000) register, there are two bits for the base nametable (basically, the nametable to snap back to, even though
			it doesn't look to be snapping back to any nametable).
			<br>
			<br>
			To implement this fix, we can add another variable, NTScroll. Then, as the X or Y scroll rolls over, we can invert the approprate bit. (Since there are 4 nametables
			in a grid, you can invert bit 0 when the X scroll rolls over, and you can invert bit 1 when the Y scroll rolls over.) Then, we can OR it into the PPU Control register
			(before the writes to $2005).
		</p>
		<br>
		<p class="code">
			inc XScroll
			<br>
			bne :+
			<br>
			lda NTScroll
			<br>
			eor #$01
			<br>
			sta NTScroll
			<br>
			:
			<br>
			<br>
			inc YScroll
			<br>
			bne :+
			<br>
			lda NTScroll
			<br>
			eor #$02
			<br>
			sta NTScroll
			<br>
			:
			<br>
			<br>
			lda #%10001000
			<br>
			ora NTScroll
			<br>
			sta PpuControl_2000
		</p>
		<br>
		<br>
		<p>
			Here is the result of this code:
		</p>
		<img src="scroll2.gif" alt="Scrolling with $2005 and $2000">
		<br>
		<br>
		<p>
			However, there is still one problem. Since screens are 256x240 pixels, Y scrolls 240-255 don't work, and simply act as a scroll value of 0. However, 
			the fix is simple: you can just add
			<a style="font-family: monospace; margin-left: 10px; margin-right: 10px;">lda YScroll</a>,
			<a style="font-family: monospace; margin-left: 10px; margin-right: 10px;">cmp #240</a> before the branch, change the branch to
			<a style="font-family: monospace; margin-left: 10px; margin-right: 10px;">bcs</a>, and add 
			<a style="font-family: monospace; margin-left: 10px; margin-right: 10px;">lda #0</a>,
			<a style="font-family: monospace; margin-left: 10px; margin-right: 10px;">sta YScroll</a> with the bit inverting code to reset the Y scroll to 0.
		</p>
		<br>
		<p class="code">
			inc YScroll
			<br>
			lda YScroll
			<br>
			cmp #240
			<br>
			bcc :+
			<br>
			lda NTScroll
			<br>
			eor #$02
			<br>
			sta NTScroll
			<br>
			lda #0
			<br>
			sta YScroll
			<br>
			:
		</p>
		<br>
		<br>
		<img src="scroll3.gif" alt="Scrolling with $2005, $2000, and adjusted Y scrolling">
		<br>
		<br>
		<p>
			However, this code only works for incrementing the scroll by one. However, these subroutines work for greater values, both with adding and subtracting:
		</p>
		<br>
		<p class="code">
			AddScrollY:
		</p>
		<p class="code" style="margin-left: 86px;">
			clc
			<br>
			adc YScroll
			<br>
			bcs @Adjust
			<br>
			cmp #$f0
			<br>
			bcs @Adjust
			<br>
			sta YScroll
			<br>
			rts
			<br>
			@Adjust:
		</p>
		<p class="code" style="margin-left: 142px;">
			adc #15
			<br>
			sta YScroll
			<br>
			lda NTScroll
			<br>
			eor #$02
			<br>
			sta NTScroll
			<br>
			rts
		</p>
		<br>
		<p class="code">
			SubtractScrollY: &nbsp; ; Note that this requires a temp value in RAM
		</p>
		<p class="code" style="margin-left: 86px;">
			sta Temp
			<br>
			lda YScroll
			<br>
			sec
			<br>
			sbc Temp
			<br>
			bcc @Adjust
			<br>
			sta YScroll
			<br>
			rts
			<br>
			@Adjust:
		</p>
		<p class="code" style="margin-left: 142px;">
			sbc #15
			<br>
			sta YScroll
			<br>
			lda NTScroll
			<br>
			eor #$02
			<br>
			sta NTScroll
			<br>
			rts
		</p>
		<br>
		<br>
		<p>
			These subroutines will add/subtract from the Y scroll, and then adjust if the scroll value is in or passed the 240-255 range.
		</p>
	</div>
</body>
