<!DOCTYPE html>
<head>
	<link rel="stylesheet" href="styles.css">
</head>
<body>
	<div class="top-area" style="height: 150px;">
		<div class="title">
			<p>
				captrojothe3rd.github.io
			</p>
		</div>
		<div id="chrome-height-adjust" style="height: 0px;"></div>
		<div class="subtitle-adjust">
			<div class="normal-centered-text">
				<p>
					eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
				</p>
			</div>
			<div style="width: 50%; margin: auto; margin-top: -20px;">
				<center>
					<button class="top-area-button" onclick="window.location.href='https://captrojothe3rd.github.io'">Home</button>
					<button class="top-area-button" onclick="window.location.href='https://captrojothe3rd.github.io/calculators'">Calculators</button>
					<button class="top-area-button" onclick="window.location.href='https://captrojothe3rd.github.io/nesguide'">NES Programming</button>
				</center>
			</div>
		</div>
	</div>

	<div class="side-area">
		<br>
		<!-- Title -->
		<p style="line-height: 10px; margin-top: 10px; font-size: 20px; margin-left: 10px;">NES Programming Guide</p>
			<!--1 - Software-->
			<a href="/nesguide/software" style="font-size: 16px; margin-left: 30px;">1 - Software</a>
			<br>
				<!--1.1 - CA65-->
				<a href="/nesguide/software/ca65" style="font-size: 16px; margin-left: 50px;">1.1 - CA65</a>
				<br>
				<!--1.2 - VSCode-->
				<a href="/nesguide/software/vscode" style="font-size: 16px; margin-left: 50px;">1.2 - VSCode</a>
				<br>
				<!--1.3 - YYCHR-->
				<a href="/nesguide/software/yychr" style="font-size: 16px; margin-left: 50px;">1.3 - YYCHR</a>
				<br>
				<!--1.4 - NES Emulator-->
				<a href="/nesguide/software/emulator" style="font-size: 16px; margin-left: 50px;">1.4 - NES Emulator</a>
				<br>
				<!--1.5 - Hex Editor-->
				<a href="/nesguide/software/hex" style="font-size: 16px; margin-left: 50px;">1.5 - Hex Editor</a>
				<br>
				<!--1.6 - Python-->
				<a href="/nesguide/software/python" style="font-size: 16px; margin-left: 50px;">1.6 - Python</a>
				<br>
			<!--2 - Setup-->
			<a href="/nesguide/setup" style="font-size: 16px; margin-left: 30px;">2 - Setup</a>
			<br>
				<!--2.1 - Required Code-->
				<a href="/nesguide/setup/requiredcode" style="font-size: 16px; margin-left: 50px;">2.1 - Required Code</a>
				<br>
				<!--2.2 - Adding CHR-ROM Data-->
				<a href="/nesguide/setup/chrrom" style="font-size: 16px; margin-left: 50px;">2.2 - Adding CHR-ROM Data</a>
				<br>
				<!--2.3 - Build Task-->
				<a href="/nesguide/setup/buildtask" style="font-size: 16px; margin-left: 50px;">2.3 - Build Task</a>
				<br>
			<!--3 - 6502 Assembly-->
			<a href="/nesguide/6502assembly" style="font-size: 16px; margin-left: 30px;">3 - 6502 Assembly</a>
			<br>
				<!--3.1 - CA65 Features-->
				<a href="/nesguide/6502assembly/ca65features" style="font-size: 16px; margin-left: 50px;">3.1 - CA65 Features</a>
				<br>
				<!--3.2 - Load/Store Instructions-->
				<a href="/nesguide/6502assembly/loadstore" style="font-size: 16px; margin-left: 50px;">3.2 - Load/Store Instructions</a>
				<br>
				<!--3.3 - Arithmetic Instructions-->
				<a href="/nesguide/6502assembly/arithmetic" style="font-size: 16px; margin-left: 50px;">3.3 - Arithmetic Instructions</a>
				<br>
				<!--3.4 - Comparison Instructions-->
				<a href="/nesguide/6502assembly/comparison" style="font-size: 16px; margin-left: 50px;">3.4 - Comparison Instructions</a>
				<br>
				<!--3.5 - Jump/Branching Instructions-->
				<a href="/nesguide/6502assembly/jumpbranching" style="font-size: 16px; margin-left: 50px;">3.5 - Jump/Branching Instructions</a>
				<br>
				<!--3.6 - Register/Flag Instructions-->
				<a href="/nesguide/6502assembly/registerflag" style="font-size: 16px; margin-left: 50px;">3.6 - Register/Flag Instructions</a>
				<br>
				<!--3.7 - Stack Instructions-->
				<a href="/nesguide/6502assembly/stack" style="font-size: 16px; margin-left: 50px;">3.7 - Stack Instructions</a>
				<br>
				<!--3.8 - Illegal Instructions-->
				<a href="/nesguide/6502assembly/illegal" style="font-size: 16px; margin-left: 50px;">3.8 - Illegal Instructions</a>
				<br>
			<!--4 - NES Hardware-->
			<a href="/nesguide/hardware" style="font-size: 16px; margin-left: 30px;">4 - NES Hardware</a>
			<br>
				<!--4.1 - Memory Layout-->
				<a href="/nesguide/hardware/memorylayout" style="font-size: 16px; margin-left: 50px;">4.1 - Memory Layout</a>
				<br>
				<!--4.2 - CPU Registers-->
				<a href="/nesguide/hardware/cpuregisters" style="font-size: 16px; margin-left: 50px;">4.2 - CPU Registers</a>
				<br>
				<!--4.3 - PPU Registers-->
				<a href="/nesguide/hardware/ppuregisters" style="font-size: 16px; margin-left: 50px;">4.3 - PPU Registers</a>
				<br>
			<!--5 - Graphics-->
			<a href="/nesguide/graphics" style="font-size: 16px; margin-left: 30px;">5 - Graphics</a>
			<br>
				<!--5.1 - Editing CHR-ROM-->
				<a href="/nesguide/graphics/editingchrrom" style="font-size: 16ppx; margin-left: 50px;">5.1 - Editing CHR-ROM</a>
				<br>
				<!--5.2 - Palettes-->
				<a href="/nesguide/graphics/palettes" style="font-size: 16px; margin-left: 50px;">5.2 - Palettes</a>
				<br>
				<!--5.3 - Background Tiles-->
				<a href="/nesguide/graphics/bgtiles" style="font-size: 16px; margin-left: 50px;">5.3 - Background Tiles</a>
				<br>
				<!--5.4 - Sprites-->
				<a href="/nesguide/graphics/sprites" style="font-size: 16px; margin-left: 50px;">5.4 - Sprites</a>
				<br>
				<!--5.5 - OAM DMA-->
				<a href="/nesguide/graphics/oamdma" style="font-size: 16px; margin-left: 50px;">5.5 - OAM DMA</a>
				<br>
				<!--5.6 - Scrolling-->
				<a href="/nesguide/graphics/scrolling" style="font-size: 16px; margin-left: 50px;">5.6 - Scrolling</a>
				<br>
				<!--5.7 - Sprite 0-->
				<a href="/nesguide/graphics/spritezero" style="font-size: 16px; margin-left: 50px;">5.7 - Sprite 0</a>
				<br>
			<!--6 - Audio-->
			<a href="/nesguide/audio" style="font-size: 16px; margin-left: 30px;">6 - Audio</a>
			<br>
				<!--6.1 - Square Channels-->
				<a href="/nesguide/audio/square" style="font-size: 16px; margin-left: 50px;">6.1 - Square Channels</a>
				<br>
				<!--6.2 - Triangle Channel-->
				<a href="/nesguide/audio/triangle" style="font-size: 16px; margin-left: 50px;">6.2 - Triangle Channel</a>
				<br>
				<!--6.3 - Noise Channel-->
				<a href="/nesguide/audio/noise" style="font-size: 16px; margin-left: 50px;">6.3 - Noise Channel</a>
				<br>
				<!--6.4 - DPCM-->
				<a href="/nesguide/audio/dpcm" style="font-size: 16px; margin-left: 50px;">6.4 - DPCM</a>
				<br>
			<!--7 - Input-->
			<a href="/nesguide/input" style="font-size: 16px; margin-left: 30px;">7 - Input</a>
			<br>
				<!--7.1 - 1/2 Controllers-->
				<a href="/nesguide/input/singlecontroller" style="font-size: 16px; margin-left: 50px;">7.1 - 1/2 Controllers</a>
				<br>
				<!--7.2 - 3/4 Controllers Using Four Score-->
				<a href="/nesguide/input/fourscore" style="font-size: 16px; margin-left: 50px;">7.2 - 3/4 Controllers Using Four Score</a>
				<br>
				<!--7.3 - Zapper Gun-->
				<a href="/nesguide/input/zappergun" style="font-size: 16px; margin-left: 50px;">7.3 - Zapper Gun</a>
				<br>
				<!--7.4 - Family Basic Keyboard-->
				<a href="/nesguide/input/familybasickeyboard" style="font-size: 16px; margin-left: 50px;">7.4 - Family Basic Keyboard</a>
				<br>
				<!--7.5 - Power Pad-->
				<a href="/nesguide/input/powerpad" style="font-size: 16px; margin-left: 50px;">7.5 - Power Pad</a>
				<br>
			<!--8 - Mappers-->
			<a href="/nesguide/mappers" style="font-size: 16px; margin-left: 30px;">8 - Mappers</a>
			<br>
				<!--8.1 - MMC1-->
				<a href="/nesguide/mappers/mmc1" style="font-size: 16px; margin-left: 50px;">8.1 - MMC1</a>
				<br>
				<!--8.2 - MMC3-->
				<a href="/nesguide/mappers/mmc3" style="font-size: 16px; margin-left: 50px;">8.2 - MMC3</a>
				<br>
				<!--8.3 - MMC5-->
				<a href="/nesguide/mappers/mmc5" style="font-size: 16px; margin-left: 50px;">8.3 - MMC5</a>
				<br>
	</div>

	<div class="main-area">
		<p>
			Sprite Zero is a PPU feature of the first sprite in OAM RAM ($00-$03) that allows for timing an event at a specific point in rendering. An example of this is the 
			status bar in Super Mario Bros. - while the level scrolls, the status bar is stationary. This is accomplished with Sprite Zero.
		</p>
		<br>
		<p>
			Unlike the IRQ timing with some mappers, Sprite Zero requires contstant polling of PPU Status ($2002). Below is a picture of Mesen's Event Viewer, showing SMB1
			polling for a Sprite Zero Hit. The orange events are reads from $2002.
		</p>
		<img src="eventviewersmb1.png" alt="Event Viewer of SMB1" style="width: 681px; height: 465px;">
		<br>
		<br>
		<p>
			As long as the game starts polling $2002 before the sprite appears, you can run the polling code whenever. You can see that in SMB1, there is some code that runs
			before, since it takes a consistent amount of time. 
		</p>
		<br>
		<p>
			In this case, the game modifies the X scroll by writing to PPU Scroll ($2005). You can see that while it does write to $2005 a second time, the Y scroll can't be modified mid-frame
			with this register. That is more difficult, and requires writes to PPU Address ($2006).
			<br>
			<br>
			Detecting a Sprite Zero Hit requires polling PPU Status ($2002), more specifically bit 6.
		</p>
		<br>
		<p class="code">
			$2002: PPU Status
		</p>
		<p class="code" style="margin-left: 86px;">
			VSO. ....
			<br>
			|||+-++++-- Least significant bits previously written into a PPU register
			<br>
			||+-------- Sprite overflow (bugged)
			<br>
			|+--------- <strong style="font-size: 13px;">Sprite 0 Hit</strong>
			<br>
			+---------- vBlank (0: not in vBlank; 1: in vBlank)
		</p>
		<br>
		<br>
		<p>
			Waiting for a sprite zero hit can be done with just two instructions. The BIT instruction copies bit 6 into the overflow flag, so we can repeatedly bit test PPU Status ($2002) and
			branch back to the beginning of the loop if the overflow flag is clear. 
			<br>
			The Sprite Zero flag is cleared at the end of vBlank, so NMI needs to run until then. If there is nothing to do, a simple loop will work.
		</p>
		<br>
		<p class="code">
			:
		</p>
		<p class="code" style="margin-left: 86px;">
			bit PpuStatus_2002
			<br>
			bvc :-
		</p>
		<p class="code">
			<br>
			lda #$20
			<br>
			sta PpuAddress_2006
			<br>
			lda #$00
			<br>
			sta PpuAddress_2006
			<br>
			<br>
		</p>
		<p class="code">
			NMI:
		</p>
		<p class="code" style="margin-left: 86px;">
			; .. Other NMI Code ..
			<br>
			<br>
			ldx #0
			<br>
			:
		</p>
		<p class="code" style="margin-left: 142px;">
			nop
			<br>
			nop
			<br>
			nop
			<br>
			dex
			<br>
			bne :-
		</p>
		<br>
		<br>
		<p>
			This bit in PPU Status ($2002) is enabled when a non-zero pixel of Sprite Zero (a pixel that isn't transparent) overlaps an opaque pixel of the background (a pixel
			that isn't the global background color).
			<br>
			<br>
			This means that wherever you want a Sprite Zero Hit to occur, you need there to be a tile that doesn't contain any background-color pixels where the sprite is. The sprite
			also needs to have no transparency (at least where you want the event to take place; the top-left corner makes the most sense). The Sprite Zero Hit does occur
			regardless of the background priority bit in the sprite's attributes, however.
			<br>
			<br>
			Below, using the smiley face sprite from the sprite guide, as well as a background tile with a single pixel, is an example of using a Sprite Zero Hit. This does more
			than just SMB1 though, and basically resets scrolling to the top-left corner, except mid-frame. You can see how the "Hello, World!" text is rendered twice.
		</p>
		<img src="spritezeroexample.png" alt="Sprite zero example" style="width: 587px; height: 508px;">
	</div>
</body>
